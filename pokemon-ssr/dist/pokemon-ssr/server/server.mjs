import { createRequire } from 'node:module';
globalThis['require'] ??= createRequire(import.meta.url);
import{a as m,d as A}from"./chunk-ALW5VTGR.mjs";import L from"./angular-app-engine-manifest.mjs";var l;function R(r){l=r}function C(){if(!l)throw new Error("Angular app engine manifest is not set. Please ensure you are using the '@angular/build:application' builder to build your server application.");return l}function y(r){return r[0]==="/"?r:`/${r}`}function E(...r){let s=[];for(let t of r){if(t==="")continue;let e=t;t[0]==="/"&&(e=e.slice(1)),t[t.length-1]==="/"&&(e=e.slice(0,-1)),e!==""&&s.push(e)}return y(s.join("/"))}var u=(function(r){return r[r.Server=0]="Server",r[r.Client=1]="Client",r[r.Prerender=2]="Prerender",r})(u||{});var $=new RegExp("(?<!\\\\):([^/]+)","g");var d=class{store=new Map;async run(s,t){let e=this.store.get(s);switch(s){case"html:transform:pre":{if(!e)return t.html;let n=m({},t);for(let o of e)n.html=await o(n);return n.html}default:throw new Error(`Running hook "${s}" is not supported.`)}}on(s,t){let e=this.store.get(s);e?e.push(t):this.store.set(s,[t])}has(s){return!!this.store.get(s)?.length}};var D={[u.Prerender]:"ssg",[u.Server]:"ssr",[u.Client]:""};function T(r,s){let{pathname:t}=r,e=s.length;t[e]==="/"&&e++;let n=t.indexOf("/",e);return n===-1&&(n=t.length),t.slice(e,n)}function b(r){if(r==="*")return new Map([["*",1]]);let s=r.split(",").map(t=>{let[e,n]=t.split(";",2).map(i=>i.trim()),o=n?.startsWith("q=")?parseFloat(n.slice(2)):void 0;return(typeof o!="number"||isNaN(o)||o<0||o>1)&&(o=1),[e,o]}).sort(([t,e],[n,o])=>o-e);return new Map(s)}function x(r,s){if(s.length<2)return s[0];let t=b(r);if(t.size===0||t.size===1&&t.has("*"))return s[0];let e=new Map;for(let i of s)e.set(g(i),i);let n,o=new Set;for(let[i,a]of t){let c=g(i);if(a===0){o.add(c);continue}if(e.has(c))return e.get(c);if(n!==void 0)continue;let[S]=c.split("-",1);for(let p of e.keys())if(p.startsWith(S)){n=e.get(p);break}}if(n!==void 0)return n;for(let[i,a]of e)if(!o.has(i))return a}function g(r){return r.toLowerCase()}var f=(()=>{class r{static \u0275allowStaticRouteRender=!1;static \u0275hooks=new d;manifest=C();supportedLocales=Object.keys(this.manifest.supportedLocales);entryPointsCache=new Map;async handle(t,e){let n=await this.getAngularServerAppForRequest(t);return n?n.handle(t,e):this.supportedLocales.length>1?this.redirectBasedOnAcceptLanguage(t):null}redirectBasedOnAcceptLanguage(t){let{basePath:e,supportedLocales:n}=this.manifest,{pathname:o}=new URL(t.url);if(o!==e)return null;let i=x(t.headers.get("Accept-Language")||"*",this.supportedLocales);if(i){let a=n[i];if(a!==void 0)return new Response(null,{status:302,headers:{Location:E(o,a),Vary:"Accept-Language"}})}return null}async getAngularServerAppForRequest(t){let e=new URL(t.url),n=await this.getEntryPointExportsForUrl(e);if(!n)return null;let o=n.\u0275getOrCreateAngularServerApp;return o({allowStaticRouteRender:r.\u0275allowStaticRouteRender,hooks:r.\u0275hooks})}getEntryPointExports(t){let e=this.entryPointsCache.get(t);if(e)return e;let{entryPoints:n}=this.manifest,o=n[t];if(!o)return;let i=o();return this.entryPointsCache.set(t,i),i}getEntryPointExportsForUrl(t){let{basePath:e,supportedLocales:n}=this.manifest;if(this.supportedLocales.length===1)return this.getEntryPointExports(n[this.supportedLocales[0]]);let o=T(t,e);return this.getEntryPointExports(o)??this.getEntryPointExports("")}}return r})();R(L);var h={};A(h,{default:()=>I,netlifyAppEngineHandler:()=>P});var v=()=>typeof Netlify<"u"?Netlify?.context:void 0;import{join as w}from"path";var N=w(process.cwd(),"dist/pokemon-ssr/browser"),_=new f;async function P(r){let s=v(),e=new URL(r.url).pathname;if(/\.(css|js|png|jpg|jpeg|gif|svg|ico|woff|woff2|ttf|eot|webp|avif)$/i.test(e)){let o=w(N,e.slice(1));try{let i=await fetch(`file://${o}`);if(i.ok){let a=new Headers(i.headers);return a.set("Cache-Control","public, max-age=31536000, immutable"),new Response(i.body,{status:200,headers:a})}}catch{}}return await _.handle(r,{context:s})??new Response("Not Found",{status:404})}var I={async fetch(r){return P(r)}};var M="default",X=h[M];export{f as AngularAppEngine,X as default,P as netlifyAppEngineHandler};
